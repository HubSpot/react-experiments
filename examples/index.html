<html>
<head>
  <meta charset="UTF-8">
  <title>react-experiments example</title>
</head>
<body>
  <div class="examples-container"></div>

  <script src="http://cdn.jsdelivr.net/react/0.13.3/react-with-addons.js"></script>
  <script src="http://cdn.jsdelivr.net/react/0.13.3/JSXTransformer.js"></script>
  <script src="../node_modules/planout/dist/planout.js"></script>
  <script src="../dist/react-experiments.js"></script>
  <script type="text/javascript">
    /* This is the sample experiment taken from https://github.com/HubSpot/PlanOut.js/blob/master/examples/sample_planout_es5.js */

    Object.getOwnPropertyDescriptors = function getOwnPropertyDescriptors(obj) {
      var descriptors = {};
      for (var prop in obj) {
        if (obj.hasOwnProperty(prop)) {
          descriptors[prop] = Object.getOwnPropertyDescriptor(obj, prop);
        }
      }
      return descriptors;
    };
     
    Function.prototype.extend = function extend(proto) {
        var superclass = this;
        var constructor;
     
        if (!proto.hasOwnProperty('constructor')) {
          Object.defineProperty(proto, 'constructor', {
            value: function () {
                // Default call to superclass as in maxmin classes
                superclass.apply(this, arguments);
            },
            writable: true,
            configurable: true,
            enumerable: false
          });
        }
        constructor = proto.constructor;
        
        constructor.prototype = Object.create(this.prototype, Object.getOwnPropertyDescriptors(proto));
        
        return constructor;
    };

    /* End extend helper */

    var DemoExperiment = window.PlanOut.Experiment.extend({
      setup: function() {
        this.name = "SampleExperiment";
      },
      assign: function(params, args) {
        params.set(
          'foo',
          new window.PlanOut.Ops.Random.UniformChoice({
            'choices': ['Variation A', 'Variation B'],
            'unit': args.id
          })
        );

        params.set(
          'test2',
          new window.PlanOut.Ops.Random.UniformChoice({
            'choices': ['Num1', 'Num2'],
            'unit': args.id
          })
        );
      },
      configureLogger: function() {
        return;
      },
      log: function(stuff) {
        console.log(stuff);
      },
      getParamNames: function() {
        return this.getDefaultParamNames();
      },
      previouslyLogged: function() {
        return this._exposureLogged;
      }
    });
    window.userid = Math.floor(Math.random() * 1000);
    window.demo = new DemoExperiment({'id': userid});
  </script>
  <script type="text/jsx">
    var VariationExperiment = React.createClass({
      render: function() {
        return (
            <ReactExperiments.ABTest experiment={window.demo} experimentName='SampleExperiment' on='foo'>
              <ReactExperiments.When value='Variation A'>
                Variation A
              </ReactExperiments.When>
              <ReactExperiments.When value='Variation B'>
                Variation B
              </ReactExperiments.When>
              <ReactExperiments.Default>
                test
              </ReactExperiments.Default>
            </ReactExperiments.ABTest>
        );
      }
    });
    
    var FooComponent = React.createClass({
      contextTypes: {
        experimentParameters: React.PropTypes.object.isRequired
      },

      render: function() {
        return (
          <span>
            This is passed down by context:
            {this.context.experimentParameters.foo}
          </span>
        );
      }
    });

    var TextComponent = React.createClass({ 
      render: function() {
        return (
          <span>
            This is passed down by props: {this.props.foo}
            <br />
            <FooComponent />
          </span>
        );
      }
    });

    TextComponent = ReactExperiments.withExperimentParams(TextComponent);
    
    var ParametrizeExperiment = React.createClass({
      render: function() {
        return (
          <ReactExperiments.Parametrize experiment={window.demo}>
            <TextComponent />
          </ReactExperiments.Parametrize>
        );
      }
    });

    var ExperimentExamples = React.createClass({
      render: function() {
        return (
          <div>
            <span>Your user id is {window.userid}</span>
            <br />
            <span>This is an experiment just using the parametrize component</span>
            <br />
            <ParametrizeExperiment />
            <br />
            <span>This is an experiment using the ABTest component</span>
            <VariationExperiment />
          </div>
        );
      }

    });

    React.render(
      <ExperimentExamples/>,
      document.getElementsByClassName('examples-container')[0]
    );
  </script>
</body>
</html>